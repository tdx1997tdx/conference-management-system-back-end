1. 设备连接MQTT服务器时就会带有`设备ID`，连接成功之后在MQTT服务器后台就可以看到；如果不能获取MQTT服务器上的客户端（设备）信息也没有关系，往下看

2. 连接成功后，设备会向名为`Register`的Topic发送设备JSON格式信息，QoS=2。以灯设备为例，格式如下

   ``` JSON
   {
       "device_id":"2",
    	"device_type":"Light",
       "device_name":"xx",
       "brand":"xx",
   }
   ```

   `deviceId`为ANDROID_ID，安卓设备在设备首次启动时，系统随机生成的一个64位的数字，并把这个数字以16进制字符串的形式保存下来

   `deviceType`为设备类型，目前的设备类型有

   ```JAVA
   class DeviceType {
       static final String LIGHT = "Light";
       static final String TV = "TV";
       static final String SOUNDBOX = "SoundBox";
       static final String AIRCON = "AirCon";
   }
   ```

3. 连接成功后，除了向`Register`发送消息以外，还会订阅名为`AssignRoom`的Topic，QoS=2；此Topic是服务器用来向设备发送被分配的房间信息的，格式如下：

   ```Json
   {
     "device_id":"2",
     "room_name":"Room101"
   }
   ```

   当设备接收到`AssignRoom`的消息时，会验证`devceId`与自己是否匹配（因为所有其他设备也会订阅此Topic），如果匹配，则设备会订阅名为`$roomId`，在这里也就是房间号`Room101`的Topic；最后设备取消订阅`AssignRoom`（还没实现）

4. 在设备成功订阅以房间号为名的Topic之后，服务器可以向设备发送控制信息，格式如下：

   ```Json
   {
     "deviceId":"f4d2341acc016675",
     "command":"on"
   }
   ```

   同样设备会核对`deviceId`（因为同一个房间其他设备也会订阅同一个Topic，但是房间里并不会有太多设备，而且控制命令也很短，所以信息量并不会有多大），这里的`command`的内容是控制设备的命令，目前只有`on`或`off`，对于会议室大电视来说，还有一个在会议结束前15分钟显示提示的命令，目前还没有做。

   

